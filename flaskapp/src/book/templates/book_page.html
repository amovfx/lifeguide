<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script   src="https://code.jquery.com/jquery-3.6.0.slim.min.js"   integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="   crossorigin="anonymous"></script>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify/themes/vue.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wruczek/Bootstrap-Cookie-Alert@gh-pages/cookiealert.css">
    <link rel="stylesheet" href="{{ url_for('/book.static', filename='css/page.css')}}">

    <title>Title</title>
</head>
<body>
<div class="alert alert-warning" role="alert">
  This website is in beta
</div>
<div class="page">
    <div id="page-contents" class="md-content unselectable">
    </div>
    <div class="page-number">
        <p id="page-number-text">
        </p>
    </div>

    <div class="alert text-center cookiealert" role="alert">
        <b>The only cookie we store is to remember what page you are on.</b>

        <button type="button" class="btn btn-primary btn-sm acceptcookies">
            Remember my page!
        </button>
            <button type="button" class="btn btn-warning btn-sm acceptcookies">
            No!
        </button>
    </div>
</div>

</body>
</html>


<script src="https://cdn.jsdelivr.net/gh/Wruczek/Bootstrap-Cookie-Alert@gh-pages/cookiealert.js"></script>
<script>
window.addEventListener("cookieAlertAccept", function() {

})
</script>
<script>
    var page_num = 0;
    var page_count = {{ page_count | safe }};



    const delta = 6;
    let startX;
    let startY;

    document.addEventListener('mousedown', function (event) {
      startX = event.pageX;
      startY = event.pageY;
    });

    function get_page(page_num)
    {
        fetch(`/book/content/${page_num}`).then
        (
            (response) =>
            {
                response.json().then((data) =>
                {
                    console.log(data);
                    $("#page-contents").html(data);
                })

            }
        )
    }

    document.addEventListener('mouseup', function (event) {
      const dX = event.pageX - startX;
      if (Math.abs(dX) > 1)
      {
            if (Math.sign(dX) < 0)
            {
                let next = (page_num + 1) % page_count;
                page_num += 1;
                get_page(next);
            }
            else
            {
                let prev = (page_num - 1) % page_count;
                page_num -= 1;
                get_page(prev);
            }
      }
    });

    document.addEventListener('touchstart', handleTouchStart, false);
    document.addEventListener('touchmove', handleTouchMove, false);

    var xDown = null;
var yDown = null;

function getTouches(evt) {
  return evt.touches ||             // browser API
         evt.originalEvent.touches; // jQuery
}

function handleTouchStart(evt) {
    const firstTouch = getTouches(evt)[0];
    xDown = firstTouch.clientX;
    yDown = firstTouch.clientY;
};

function handleTouchMove(evt) {
    if ( ! xDown || ! yDown ) {
        return;
    }

    var xUp = evt.touches[0].clientX;
    var yUp = evt.touches[0].clientY;

    var xDiff = xDown - xUp;
    var yDiff = yDown - yUp;

    if ( Math.abs( xDiff ) > Math.abs( yDiff ) ) {/*most significant*/
        if ( xDiff > 0 ) {
            let next = (page_num - 1) % page_count;
            page_num -= 1;
            get_page(next);
        } else {
            let next = (page_num + 1) % page_count;
            page_num += 1;
            get_page(next);
        }
    } else {
        if ( yDiff > 0 ) {
            /* down swipe */
        } else {
            /* up swipe */
        }
    }
    /* reset values */
    xDown = null;
    yDown = null;
};

    window.addEventListener("load", function(){
        get_page(0);
    });


</script>